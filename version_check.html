<!DOCTYPE html>
<html>
<head>
    <title>Combat Closet Version Check</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
        }
        .version-container {
            text-align: center;
            padding: 20px;
        }
        .current-version {
            font-size: 18px;
            margin-bottom: 15px;
            color: #87CEEB;
        }
        .latest-version {
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 15px;
        }
        .status {
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
        }
        .up-to-date {
            color: #90EE90;
        }
        .update-available {
            color: #FF6B6B;
        }
    </style>
</head>
<body>
    <div class="version-container">
        <div class="current-version">Your version: <span id="currentVersion">Loading...</span></div>
        <div>Latest version:</div>
        <div class="latest-version" id="latestVersion">1.1.0</div>
        <div class="status" id="status">Checking...</div>
    </div>

    <script>
        // Get current version from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const currentVersion = urlParams.get('current') || 'Unknown';
        const latestVersion = document.getElementById('latestVersion').textContent.trim();

        // Display current version
        document.getElementById('currentVersion').textContent = currentVersion;

        // Compare versions and show status
        function compareVersions(current, latest) {
            const parseVersion = (v) => v.split('.').map(num => parseInt(num, 10));
            const currentParsed = parseVersion(current);
            const latestParsed = parseVersion(latest);

            for (let i = 0; i < Math.max(currentParsed.length, latestParsed.length); i++) {
                const currentNum = currentParsed[i] || 0;
                const latestNum = latestParsed[i] || 0;
                if (latestNum > currentNum) return 1;
                if (latestNum < currentNum) return -1;
            }
            return 0;
        }

        const comparison = compareVersions(currentVersion, latestVersion);
        const statusElement = document.getElementById('status');

        if (comparison > 0) {
            statusElement.textContent = 'ðŸ”„ Update Available - Please update via Discord or Manager';
            statusElement.className = 'status update-available';
        } else if (comparison === 0) {
            statusElement.textContent = 'âœ… You have the latest version!';
            statusElement.className = 'status up-to-date';
        } else {
            statusElement.textContent = 'ðŸš€ You have a newer version than released!';
            statusElement.className = 'status up-to-date';
        }

        // Try to call back to the addon with version information (like Treasure Hunter does)
        setTimeout(function() {
            try {
                // Try different ways to access the parent window's global functions
                if (window.parent && window.parent._G && window.parent._G.OnVersionCheckComplete) {
                    window.parent._G.OnVersionCheckComplete(currentVersion, latestVersion, comparison);
                } else if (window._G && window._G.OnVersionCheckComplete) {
                    window._G.OnVersionCheckComplete(currentVersion, latestVersion, comparison);
                } else if (window.top && window.top._G && window.top._G.OnVersionCheckComplete) {
                    window.top._G.OnVersionCheckComplete(currentVersion, latestVersion, comparison);
                }
            } catch (e) {
                console.log('Could not call back to addon:', e);
            }
        }, 1000); // Wait 1 second for the page to fully load
    </script>
</body>
</html>
